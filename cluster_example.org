#+begin_src ruby
kmers_json = <<JSON
{"GTGTACATGTCGATGC": [113, 1]
, "GTGTACATGTCGATGT": [23, 0.896561]
, "GTGTACATGCGATGCT": [7, 0.798848]
, "CTTGTACATGTCGATGC": [6, 0.259889]
, "GTGTACATGTCATGCT": [6, 0.306842]
, "GTGTACATGTCGTGCT": [6, 0.329062]
, "GTGTACATGTCGATTGC": [4, 0.117831]
, "GTGTACATGTCTGCTC": [4, 0.279586]
, "GTGTACATGTGGATGCT": [4, 0.0924509]
, "GTGTACATGTCGAGCT": [3, 0.142532]
, "GTGTACATGTCGAATGC": [3, 0.122288]
, "GTGTACATGTCCGATGC": [3, 0.414234]
, "GTGTACATGTCGTGTC": [3, 0.102646]
, "GTGTACATGTCGATGA": [2, 0.030334]
, "GTGTACATGCGATGCA": [2, 0.282863]
, "GAGTACACTGTCGCTG": [2, 0.0354077]
, "GTGTATACATGTCGTG": [1, 0.367132]
, "GTGTACATGTCGATTCT": [1, 0.0103594]
, "GTGTACATGTCATGTA": [1, 0.0310968]
, "GTGTACAATGTCGTGCT": [1, 0.0278993]
, "GTGTACATGTCGAGGTG": [1, 0.0752032]
, "GTGTACATGTCAATGTC": [1, 0.103659]
, "GTGTACATGTCGAATGT": [1, 0.0223707]
, "GTGTACATGTCGGATGCC": [1, 0.0332159]
, "GTGTACATGTCGTGCA": [1, 0.037486]
, "GTGTACATGTCGGATGC": [1, 0.037077]
, "GTGTACATGTCGAGCCG": [1, 0.0755326]
, "GTGTACATGCGCTGTC": [1, 0.0361614]
, "GTGTATACATGTCATG": [1, 0.0148547]
, "GTGTTACATGTGGATGCT": [1, 0.00503255]
, "GTGTACATGTCATGCGG": [1, 0.0514894]
, "GAGTACACACCACTCTG": [1, 0.0561335]
, "GAGTATACATGTCGTG": [1, 0.0240265]
, "CAGTACACTGTCGCTG": [1, 0.0119634]
, "GTGTACATGCGATGCCT": [1, 0.0828592]
, "GTGTACATGTCGACTA": [1, 0.0108699]
, "GTGTACATGCGATGTG": [1, 0.322702]
, "GTTGTTACATGTCGATGC": [1, 0.0186362]
, "GTGTACATGTCTGCTA": [1, 0.0236677]
, "GTGTACATGTCGACAGG": [1, 0.00342138]
, "GTGTACATGTCATGCCT": [1, 0.0879174]
, "CAGTACACTGTCGCTA": [1, 0.0846089]
, "GTGTACATGTCGAGTA": [1, 0.0087958]
, "CAGTACACTGTAGCTA": [1, 0.0279201]
, "GTGTACACTGTCGCTA": [1, 0.251023]
, "ATGTACGCTGTAGCTGG": [1, 0.00653765]
, "GTGTTACATGTCGATGC": [1, 0.00782994]
, "ATGTACGCTGTAGCTG": [1, 0.00743107]
, "ATGTACGCTGTCGCTA": [1, 0.027018]
, "GTGTACACTGTCCGCTA": [1, 0.128547]
}
JSON
    
  require 'json'
  kmers = JSON.parse(kmers_json).sort_by{|k, v| v.map{|x| -x}}
  
  white_pc = 80

  latex_rows = kmers.map{ |kmer, data|
    n, prob = data
    green_pc = ((n.to_f / kmers.first.last.first) * 100).round
    count_color = "green!#{green_pc}!red!#{100 - white_pc}!white"
    count_cell = "\\cellcolor{#{count_color}} #{n}"
    green_pc = (prob * 100).round
    prob_color = "green!#{green_pc}!red!#{100 - white_pc}!white"
    prob_cell = "\\cellcolor{#{prob_color}} #{"%.2f" % prob}"
      "    #{kmer} & #{count_cell} & #{prob_cell} \\\\"
  }.join("\n")

  table_header = "    \\textbf{homopolymer-space 16-mer} & \\textbf{n} & " + 
                 "\\textbf{qual.} \\\\ \\hline \n"
  latex_table = "\\begin{tabular}{|l|r|r|}\n#{table_header}#{latex_rows}\n\\hline\\end{tabular}"
#+end_src

#+results:
#+begin_example
\begin{tabular}{|l|r|r|}
    \textbf{homopolymer-space 16-mer} & \textbf{n} & \textbf{qual.} \\ \hline 
    GTGTACATGTCGATGC & \cellcolor{green!100!red!20!white} 113 & \cellcolor{green!100!red!20!white} 1.00 \\
    GTGTACATGTCGATGT & \cellcolor{green!20!red!20!white} 23 & \cellcolor{green!90!red!20!white} 0.90 \\
    GTGTACATGCGATGCT & \cellcolor{green!6!red!20!white} 7 & \cellcolor{green!80!red!20!white} 0.80 \\
    GTGTACATGTCGTGCT & \cellcolor{green!5!red!20!white} 6 & \cellcolor{green!33!red!20!white} 0.33 \\
    GTGTACATGTCATGCT & \cellcolor{green!5!red!20!white} 6 & \cellcolor{green!31!red!20!white} 0.31 \\
    CTTGTACATGTCGATGC & \cellcolor{green!5!red!20!white} 6 & \cellcolor{green!26!red!20!white} 0.26 \\
    GTGTACATGTCTGCTC & \cellcolor{green!4!red!20!white} 4 & \cellcolor{green!28!red!20!white} 0.28 \\
    GTGTACATGTCGATTGC & \cellcolor{green!4!red!20!white} 4 & \cellcolor{green!12!red!20!white} 0.12 \\
    GTGTACATGTGGATGCT & \cellcolor{green!4!red!20!white} 4 & \cellcolor{green!9!red!20!white} 0.09 \\
    GTGTACATGTCCGATGC & \cellcolor{green!3!red!20!white} 3 & \cellcolor{green!41!red!20!white} 0.41 \\
    GTGTACATGTCGAGCT & \cellcolor{green!3!red!20!white} 3 & \cellcolor{green!14!red!20!white} 0.14 \\
    GTGTACATGTCGAATGC & \cellcolor{green!3!red!20!white} 3 & \cellcolor{green!12!red!20!white} 0.12 \\
    GTGTACATGTCGTGTC & \cellcolor{green!3!red!20!white} 3 & \cellcolor{green!10!red!20!white} 0.10 \\
    GTGTACATGCGATGCA & \cellcolor{green!2!red!20!white} 2 & \cellcolor{green!28!red!20!white} 0.28 \\
    GAGTACACTGTCGCTG & \cellcolor{green!2!red!20!white} 2 & \cellcolor{green!4!red!20!white} 0.04 \\
    GTGTACATGTCGATGA & \cellcolor{green!2!red!20!white} 2 & \cellcolor{green!3!red!20!white} 0.03 \\
    GTGTATACATGTCGTG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!37!red!20!white} 0.37 \\
    GTGTACATGCGATGTG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!32!red!20!white} 0.32 \\
    GTGTACACTGTCGCTA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!25!red!20!white} 0.25 \\
    GTGTACACTGTCCGCTA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!13!red!20!white} 0.13 \\
    GTGTACATGTCAATGTC & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!10!red!20!white} 0.10 \\
    GTGTACATGTCATGCCT & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!9!red!20!white} 0.09 \\
    CAGTACACTGTCGCTA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!8!red!20!white} 0.08 \\
    GTGTACATGCGATGCCT & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!8!red!20!white} 0.08 \\
    GTGTACATGTCGAGCCG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!8!red!20!white} 0.08 \\
    GTGTACATGTCGAGGTG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!8!red!20!white} 0.08 \\
    GAGTACACACCACTCTG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!6!red!20!white} 0.06 \\
    GTGTACATGTCATGCGG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!5!red!20!white} 0.05 \\
    GTGTACATGTCGTGCA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!4!red!20!white} 0.04 \\
    GTGTACATGTCGGATGC & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!4!red!20!white} 0.04 \\
    GTGTACATGCGCTGTC & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!4!red!20!white} 0.04 \\
    GTGTACATGTCGGATGCC & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!3!red!20!white} 0.03 \\
    GTGTACATGTCATGTA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!3!red!20!white} 0.03 \\
    CAGTACACTGTAGCTA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!3!red!20!white} 0.03 \\
    GTGTACAATGTCGTGCT & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!3!red!20!white} 0.03 \\
    ATGTACGCTGTCGCTA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!3!red!20!white} 0.03 \\
    GAGTATACATGTCGTG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!2!red!20!white} 0.02 \\
    GTGTACATGTCTGCTA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!2!red!20!white} 0.02 \\
    GTGTACATGTCGAATGT & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!2!red!20!white} 0.02 \\
    GTTGTTACATGTCGATGC & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!2!red!20!white} 0.02 \\
    GTGTATACATGTCATG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!1!red!20!white} 0.01 \\
    CAGTACACTGTCGCTG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!1!red!20!white} 0.01 \\
    GTGTACATGTCGACTA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!1!red!20!white} 0.01 \\
    GTGTACATGTCGATTCT & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!1!red!20!white} 0.01 \\
    GTGTACATGTCGAGTA & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!1!red!20!white} 0.01 \\
    GTGTTACATGTCGATGC & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!1!red!20!white} 0.01 \\
    ATGTACGCTGTAGCTG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!1!red!20!white} 0.01 \\
    ATGTACGCTGTAGCTGG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!1!red!20!white} 0.01 \\
    GTGTTACATGTGGATGCT & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!1!red!20!white} 0.01 \\
    GTGTACATGTCGACAGG & \cellcolor{green!1!red!20!white} 1 & \cellcolor{green!0!red!20!white} 0.00 \\
\hline\end{tabular}
#+end_example

